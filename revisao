DROP TABLE IF EXISTS cursa;
DROP TABLE IF EXISTS telefone_aluno;
DROP TABLE IF EXISTS pre_requisito;
DROP TABLE IF EXISTS aluno_graduacao;
DROP TABLE IF EXISTS aluno_pos_graduacao;
DROP TABLE IF EXISTS disciplina;
DROP TABLE IF EXISTS professor;
DROP TABLE IF EXISTS aluno;
DROP TABLE IF EXISTS departamento;



CREATE TABLE departamento (
	codigo SERIAL PRIMARY KEY,
	nome VARCHAR(255) NOT NULL
);

CREATE TABLE professor(
	codigo SERIAL PRIMARY KEY,
	nome VARCHAR(255) NOT NULL,
	codigo_dep INTEGER NOT NULL,
	FOREIGN KEY (codigo_dep) REFERENCES departamento(codigo)
);

CREATE TABLE disciplina(
	codigo SERIAL PRIMARY KEY,
	nome VARCHAR(255) NOT NULL,
	ementa VARCHAR(255) NOT NULL,
	num_creditos INTEGER NOT NULL,
	codigo_dep INTEGER NOT NULL,
	codigo_pro INTEGER NOT NULL,
	FOREIGN KEY (codigo_dep) REFERENCES departamento(codigo),
	FOREIGN KEY (codigo_pro) REFERENCES professor(codigo)
);

CREATE TABLE pre_requisito(
	codigo_dis_requisitada INTEGER NOT NULL,
	codigo_dis_pre_req INTEGER NOT NULL,
    -- Chave primária composta para relacionar as duas disciplinas
    PRIMARY KEY (codigo_dis_requisitada, codigo_dis_pre_req),
	FOREIGN KEY (codigo_dis_requisitada) REFERENCES disciplina(codigo),
    FOREIGN KEY (codigo_dis_pre_req) REFERENCES disciplina(codigo)
);

CREATE TABLE aluno(
	codigo SERIAL PRIMARY KEY,
	nome VARCHAR(255) NOT NULL,
	endereco VARCHAR(255) NOT NULL
);

CREATE TABLE aluno_pos_graduacao(
	codigo INTEGER PRIMARY KEY REFERENCES aluno(codigo), -- PK e FK para Aluno
	formacao VARCHAR(255) NOT NULL,
	codigo_pro INTEGER NOT NULL, -- Código do Professor Orientador
	FOREIGN KEY (codigo_pro) REFERENCES professor(codigo)
);

CREATE TABLE cursa(
	media FLOAT NOT NULL,
	frequencia FLOAT NOT NULL,
	codigo_dis INTEGER NOT NULL,
	codigo_alu INTEGER NOT NULL,
	PRIMARY KEY (codigo_dis, codigo_alu),
	FOREIGN KEY (codigo_dis) REFERENCES disciplina(codigo),
	FOREIGN KEY (codigo_alu) REFERENCES aluno(codigo)
);


INSERT INTO departamento (nome) VALUES ('Computação'); -- 1
INSERT INTO departamento (nome) VALUES ('Engenharia Civil'); -- 2

INSERT INTO professor (nome, codigo_dep) VALUES ('Alan dos Santos', 1); -- 1 (Orientador)
INSERT INTO professor (nome, codigo_dep) VALUES ('Paula de Souza', 1); -- 2

INSERT INTO aluno (nome, endereco) VALUES ('Breno da Silva', 'Rua A, 100'); -- 1
INSERT INTO aluno (nome, endereco) VALUES ('Carla Oliveira', 'Av. B, 200'); -- 2
INSERT INTO aluno (nome, endereco) VALUES ('Daniela Souza', 'Rua C, 300'); -- 3

INSERT INTO aluno_pos_graduacao (codigo, formacao, codigo_pro) VALUES (1, 'Mestrado em Computação', 1); -- Breno (Orientado por Alan)
INSERT INTO aluno_pos_graduacao (codigo, formacao, codigo_pro) VALUES (2, 'Doutorado em Computação', 1); -- Carla (Orientada por Alan)
INSERT INTO aluno_pos_graduacao (codigo, formacao, codigo_pro) VALUES (3, 'Mestrado em Civil', 2); -- Daniela (Orientada por Paula)

-- DISCIPLINA (Códigos: 1, 2, 3)
INSERT INTO disciplina (nome, ementa, num_creditos, codigo_dep, codigo_pro) VALUES ('Programação I', 'Intro a Programação', 4, 1, 1); -- 1
INSERT INTO disciplina (nome, ementa, num_creditos, codigo_dep, codigo_pro) VALUES ('Estruturas de Dados', 'Listas, Árvores, etc.', 4, 1, 2); -- 2
INSERT INTO disciplina (nome, ementa, num_creditos, codigo_dep, codigo_pro) VALUES ('Cálculo I', 'Limites e derivadas', 6, 1, 2); -- 3

-- PRE_REQUISITO (Disciplina 2 (Estruturas de Dados) tem Disciplina 1 (Programação I) como pré-requisito)
INSERT INTO pre_requisito (codigo_dis_requisitada, codigo_dis_pre_req) VALUES (2, 1);

-- CURSA (Quem cursa o quê)
INSERT INTO cursa (media, frequencia, codigo_dis, codigo_alu) VALUES (8.5, 90.0, 1, 1); -- Breno cursa Programação I
INSERT INTO cursa (media, frequencia, codigo_dis, codigo_alu) VALUES (7.0, 75.0, 1, 3); -- Daniela cursa Programação I
INSERT INTO cursa (media, frequencia, codigo_dis, codigo_alu) VALUES (9.0, 100.0, 2, 2); -- Carla cursa Estruturas de Dados

